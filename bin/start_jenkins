#!/bin/sh


launch_openshift_image() {


  # Build the current image if it's not in the local registry.
  current_image_version=`grep version images/openshift/Dockerfile | awk '{print $2} | sed 's/"//g'`
  if [ `docker images | grep ci_jenkins | grep $current_image_version | wc -c` -lt 2 ]; then
    build_openshift_image
  fi

  

  

  # Create a directory mapping for the jenkins-data volume
  sudo mkdir /var/lib/jenkins 2>/dev/null && sudo chmod ugo+rwx /var/lib/jenkins

  # Launch and expose the web UI
  ip_address=`hostname -I | awk '{print $1}'`
  docker run -it --rm --name jenkins01 -d \
                -p $ip_address:8443:8443 \
                -p $ip_address:8080:8080 \
                -v /var/lib/jenkins:/var/lib/jenkins \
                --env JENKINS_PASSWORD=0000 \
                --env OPENSHIFT_ENABLE_OAUTH=false \
               openshift/jenkins-2-centos7 

   #  --link pg01:postgres \ -v/home/ec2-user/CI:/home/ec2-user/CI
    docker logs -f jenkins01
}

build_openshift_image() {
  image_version=`grep version images/openshift/Dockerfile | awk '{print $2}' | cut -f2 -d= | sed 's/\"//g'`
  cd ./images/openshift && docker build -t ci_jenkins:$image_version .
}

build() {
  build_openshift_image
}

connect() {
  docker exec -it -u 0 jenkins01 bash
}

main() {
  if [ $# -gt 0 ]; then
    $@
    exit 1
  fi
}

main $@
